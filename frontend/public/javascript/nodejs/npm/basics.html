
<h1>Introduction to NPM</h1>
<p>The Node Package Manager can be used to create NodeJS packages, these can be redistributable libraries or full applications that may run desktop or web applications.</p>
<h2>Creating a project with NPM</h2>
<p>First, ensure you have the latest version of Node JS installed, this was <code>16.15.0 LTS</code> at the time of writing: [[<a href="https://nodejs.org/en/%5D%5BNodeJS">https://nodejs.org/en/][NodeJS</a> | Home page]]</p>
<p>Bundled with Node JS is the NPM.</p>
<p>To quickly initialise a project using NPM, create a directory for your project and run <code>npm init .</code> inside of the directory.</p>
<p>This will trigger the legacy interface at which you will be prompted for information, this can be entered or skipped - afterwards a file called <code>package.json</code> will have been created for tracking information about the project, including its dependencies.</p>
<p>Fields include:</p>
<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>author</code></td>
      <td>Specifies who created the project, can be passed a simple string or an object.</td>
    </tr>
    <tr>
      <td><code>description</code></td>
      <td>A short informative description of the project, useful for selling an idea to a user and summarising a projects functionality. Accepts a string.</td>
    </tr>
    <tr>
      <td><code>keywords</code></td>
      <td>Accepts an array of double-quoted strings describing the project.</td>
    </tr>
    <tr>
      <td><code>license</code></td>
      <td>Used to specify the projects license, MIT and BSD are common open source licences. License info is not required, copyright ownership is usually implied in a lot of countries, although this may differ.</td>
    </tr>
    <tr>
      <td><code>dependencies</code></td>
      <td>Accepts an object of key value pairs of strings representing a dependency to install. The structure is as follows: `"package-name": "version".</td>
    </tr>
    <tr>
      <td><code>version</code></td>
      <td>Accepts a string representing the version of the project.</td>
    </tr>
  </tbody>
</table>
<h2>Semantic versioning (SemVer)</h2>
<p>Semantic Versioning is an industry standard for software versioning to make dependencies easier to manage, SemVer looks as follows:</p>
<pre><code class="language-json">"package": "MAJOR.MINOR.PATCH"
</code></pre>
<ul>
  <li><code>MAJOR</code> signifies changes to the API which are incompatible with previous versions</li>
  <li><code>MINOR</code> indicates backwards-compatible additional functionality.</li>
  <li><code>PATCH</code> indicates backwards-compatible bug fixes.</li>
</ul>
<h2>Managing dependency versions</h2>
<p>If the tilde character is appended to an npm dependency in the <code>package.json</code> file, it will allow the dependency to update to the latest <code>PATCH</code> version when <code>npm install</code> is ran in the project:</p>
<pre><code class="language-json">{
  "dependencies": {
    "package": "`1.2.2"
  }
}
</code></pre>
<p>The caret character allows npm to install the latest <code>MINOR</code> and <code>PATCH</code> updates:</p>
<pre><code class="language-json">{
  "dependencies": {
    "package": "`1.2.2"
  }
}
</code></pre>
<h2>Creating a project (in-depth)</h2>
<p>[[<a href="https://www.npmjs.com/%5D%5Bnpmjs">https://www.npmjs.com/][npmjs</a>]]</p>
<p>The <code>npm init</code> command, aliases being <code>npm create</code> and <code>npm init</code>, is used to setup a new or existing npm package.</p>
<p>The <code>init</code> command is transformed to an <code>npm exec</code> operation, the one for creating a new project in the current directory is as follows: <code>npm init .</code></p>
<p>This will initialise a project using legacy init behaviour, questions will be asked at the command-prompt as follows before creating a <strong>package.json</strong> file for you:</p>
<pre><code class="language-sh">Morgan Walsh@DESKTOP-LT9E09K MINGW64 ~/test/node
$ mkdir npm-example1

Morgan Walsh@DESKTOP-LT9E09K MINGW64 ~/test/node
$ cd npm-example1

Morgan Walsh@DESKTOP-LT9E09K MINGW64 ~/test/node/npm-example1
$ npm init
This utility will walk you through creating a package.json file.
It only covers the most common items, and tries to guess sensible defaults.

See `npm help init` for definitive documentation on these fields
and exactly what they do.

Use `npm install &#x3C;pkg>` afterwards to install a package and
save it as a dependency in the package.json file.

Press ^C at any time to quit.
package name: (npm-example1)
version: (1.0.0)
description: npm Example one
entry point: (index.js)
test command:
git repository:
keywords: npm javascript node
author: Morgan Walsh
license: (ISC)
About to write to C:\Users\Morgan Walsh\test\node\npm-example1\package.json:

{
    "name": "npm-example1",
    "version": "1.0.0",
    "description": "npm Example one",
    "main": "index.js",
    "scripts": {
        "test": "echo \"Error: no test specified\" &#x26;&#x26; exit 1"
    },
    "keywords": [
        "npm",
        "javascript",
        "node"
    ],
    "author": "Morgan Walsh",
    "license": "ISC"
}


Is this OK? (yes)
</code></pre>
<p>First, we navigate into a new directory for the project with <code>mkdir</code> and <code>cd</code>, then the <code>npm init</code> command is run to start initialisation of the package. A set of questions are asked concerning project-related information, these may be skipped by passing a flag: <code>npm init --yes</code></p>
<p>An <code>ls</code> of the directory shows that we only have a <strong>package.json</strong> file present, containing data about the project. We should also add an <strong>index.js</strong> as we left this as the default entry point for the application in the configuration:</p>
<pre><code class="language-sh">Morgan Walsh@DESKTOP-LT9E09K MINGW64 ~/test/node/npm-example1
$ ls
package.json

Morgan Walsh@DESKTOP-LT9E09K MINGW64 ~/test/node/npm-example1
$ touch index.js

Morgan Walsh@DESKTOP-LT9E09K MINGW64 ~/test/node/npm-example1
$ echo "console.log('Hello world')" > index.js 
</code></pre>
<p>Run the project using <code>node index.js</code> from the project root:</p>
<pre><code class="language-sh">Morgan Walsh@DESKTOP-LT9E09K MINGW64 ~/test/node/npm-example1
$ node index.js 
Hello world
</code></pre>
<h2>Installing dependencies</h2>
<p>If a project has an existing <strong>package.json</strong> file, run <code>npm install</code> to install all of the projects depdencies into the <strong>node_modules</strong> folder.</p>
<blockquote>
  <p><strong>node_modules</strong> will be created if it isn't already by the command</p>
</blockquote>
<p>To install a specific package, run <code>npm install &#x3C;package-name></code> to add the <code>&#x3C;package-name></code> to the <strong>package.json</strong> files dependencies.</p>
<ul>
  <li>Historically, prior to NPM 5, the <code>--save</code> / <code>-S</code> flag was added otherwise the dependency would not be saved to the <strong>package.json</strong> file</li>
</ul>
<p>There are two types of install available in NPM:</p>
<ul>
  <li>local</li>
  <li>global</li>
</ul>
<p>Try <code>npm install morgan</code> to install me locally into your project... Just kidding, but it will install a middleware logging utility for Node.js requests and responses. The local dependecy will be added to the <strong>package.json</strong> file alongside its version number:</p>
<pre><code class="language-json">{
    "dependencies": {
        "morgan": "^1.10.0"
    }
}
</code></pre>
<p>The <code>morgan</code> dependency is of version <code>1.10.0</code>. As it is a local dependency, it will also download the packages code to the <strong>node_modules</strong> directory - the <strong>morgan</strong> dependency is just another npm project.</p>
<blockquote>
  <p>Ensure you do not push the <strong>node_modules</strong> folder to GitHub, or another repository service, due to its large size. These dependencies can be redownloaded as required.</p>
</blockquote>
<p>Global installs are available in every npm project, just add the <code>-g</code> flag to do this. For example:</p>
<pre><code class="language-sh">npm install -g morgan
</code></pre>
<p>will download the <code>morgan</code> npm package for global usage in any project. To see its install location, use <code>npm root -g</code> to find the location - I wouldn't recommend this though.</p>
<h3>Applying the morgan logger with a vanilla HTTP server in Node.js</h3>
<pre><code class="language-js">const http = require('http');
const morgan = require('morgan');

const host = 'localhost';
const port = 3000;

const logger = morgan('dev');

const server = http.createServer((req, res) => {
    logger(req, res, err => {
    
        res.setHeader('Content-Type', 'text/plain');
        if (err) {
            console.log(err);
            res.statusCode = 500;
            res.end('Something went wrong');
            return;
        }
        res.statusCode = 200;
        res.end('Hello');
    });
});

server.listen(port, host, () => {
    console.log(`Server up on ${host}:${port}`);
});
</code></pre>
<p>The morgan logging function takes in a request, response and a callback for handling the request. The logger wraps around the request-response cycle so that it can print related information to the console. Place this code in a file called <code>index.js</code> and run it with <code>node index.js</code> to start the server, then send a request in the browser to <code>localhost:3000</code> and monitor the console.</p>
<h2>Updating dependencies</h2>
<p>Packages often require updates to keep up with modern features and security, all specified dependencies can be updated using <code>npm update</code>. Specify a specific package to update as follows: <code>npm update &#x3C;package-name></code>.</p>
<h2>Running tasks</h2>
<p>Command-line tasks can be specified in the <strong>package.json</strong> file in the <code>"scripts"</code> section. The following example adds a <code>start</code> task for starting the server:</p>
<pre><code class="language-json">{
    "scripts": {
        "start": "node ./index.js",
        "test": "echo \"Error: no test specified\" &#x26;&#x26; exit 1"
    }
}
</code></pre>
<p>The <code>start</code> task can then be run using <code>npm start</code>:</p>
<pre><code class="language-sh">Morgan Walsh@DESKTOP-LT9E09K MINGW64 ~/test/node/npm-example1
$ npm start

> npm-example1@1.0.0 start
> node ./index.js

Hello world
</code></pre>
<p>Custom scripts beyond <code>start</code> and <code>test</code> can be defined, for example:</p>
<pre><code class="language-json">{
    "scripts": {
        "start": "node ./index.js",
        "start:dev" "PORT=8080&#x26; node index.js"
        "test": "echo \"Error: no test specified\" &#x26;&#x26; exit 1"
    }
}
</code></pre>
<p>To run the custom <code>start:dev</code> task, we must specify <code>npm run start:dev</code> instead of just the <code>npm</code> command by itself.</p>
