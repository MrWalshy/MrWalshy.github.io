<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to setup SSH</title>
<link rel="stylesheet" href="/css/style.css">
    <nav class="navbar row">
    <button id="toggle" class="hamburger ml-auto"><span></span><span></span><span></span></button>
    <div class="col-12">
        <ul class="nav-content w-100 ml-auto mr-auto">
            <li class="nav-link"><a href="/">Home</a></li>
            <li class="nav-link"><a href="/blog">Blog</a></li>
        </ul>
    </div>
</nav>
    
    
    <link rel="stylesheet" href="/css/theme/prism-atom-dark.css" />

</head>
<body>
    
    
    <div class="p-16 w-60 w-md-80 w-sm-90 ml-auto mr-auto">
        <h1>How to setup SSH</h1>
        <p><b>Created on</b>: <time>Wed, 01 Feb 2023 00:00:00 GMT</time></p>

        
            <div class="row w-100">
                <div class="col-5 col-sm-12">
                    <img 
                        src="/assets/images/devops/editor-prompt.png" 
                        alt="thumbnail image" 
                    />
                </div>
        
        
        <div class="col-7 col-sm-12 pl-16 pl-sm-0">
        <h2>Tags</h2>
        <ul>
            
                <li>
                    <a href="/blog/tag/ssh">SSH</a>
                </li>
            
                <li>
                    <a href="/blog/tag/devops">DevOps</a>
                </li>
            
        </ul>
        </div></div>

        <hr />

        <p><strong>SSH</strong> (<em>Secure Shell</em>) is a network protocol used for remotely accessing a computer.</p>
<ul>
<li>Mac and Linux distributions normally come with <code>ssh</code> installed</li>
<li>Windows may require some work</li>
</ul>
<h2>Connecting to a server with SSH</h2>
<p>To <code>ssh</code> into a remote host, we use the <code>ssh</code> command followed by the remote host name (IP or domain):</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">ssh</span> <span class="token function">host</span></code></pre>
<p>This method will assume your username on the remote system is the same as the system you are running the <code>ssh</code> command from. We can also specify a specific username:</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">ssh</span> user@host</code></pre>
<h2><code>sshd</code></h2>
<p><code>sshd</code> is a daemon process, it is the server which listens for an <code>ssh</code> client connection. The <code>ssh</code> program is the client.</p>
<p>We can control the <code>ssh</code> server on Ubuntu using the <code>systemctl</code> command for managing services:</p>
<pre class="language-sh"><code class="language-sh"><span class="token comment"># start ssh server</span><br><span class="token function">sudo</span> systemctl start <span class="token function">ssh</span><br><br><span class="token comment"># enable ssh to run automatically at boot</span><br><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">ssh</span><br><br><span class="token comment"># stop ssh server</span><br><span class="token function">sudo</span> systemctl stop <span class="token function">ssh</span><br><br><span class="token comment"># restart ssh server</span><br><span class="token function">sudo</span> systemctl restart <span class="token function">ssh</span></code></pre>
<h2>Configuring SSH</h2>
<p>The configuration for the <code>sshd</code> server in Ubuntu is found at <code>/etc/ssh/sshd_config</code>. First, backup this file:</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">sudo</span> <span class="token function">cp</span> /etc/ssh/sshd_config /etc/ssh/sshd_config.backup</code></pre>
<p>Options that you may want to change in this file include:</p>
<ul>
<li><code>Port 22</code>: Change the port number to change where the <code>sshd</code> server is listening for connections</li>
<li><code>HostKey /etc/ssh/ssh_host_xxx_xxx</code>: Specifies where to search for global host keys</li>
<li><code>SysLogFacility AUTH</code>: A logging level</li>
<li><code>LogLevel INFO</code>: A logging level</li>
<li><code>LoginGraceTime 120</code>: The number of seconds to keep a connection alive without successful login</li>
<li><code>PermitRootLogin yes</code>: Sets whether the root user can log in (should be changed to <code>no</code> once a user account with access to elevated priviledges is created)</li>
<li><code>StrictModes yes</code>: Refuses a login attempt if auth files are readable by everyone</li>
<li><code>X11Forwarding yes</code>: Allows viewing the GUI of the <code>sshd</code> host</li>
<li><code>X11DisplayOffset</code></li>
</ul>
<h3>Configuring a keypair</h3>
<p>To create a keypair, use the <code>ssh-keygen</code> command:</p>
<pre class="language-sh"><code class="language-sh">ssh-keygen <span class="token parameter variable">-t</span> rsa</code></pre>
<p>Accept the defaults, this will create two files:</p>
<ul>
<li><code>id_rsa</code>: The private key file (keep this secure)</li>
<li><code>id_rsa.pub</code>: The public key file</li>
</ul>
<h4>Configuring from the server</h4>
<p>If you ran <code>ssh-keygen</code> from the server, follow the next instructions.</p>
<ol>
<li>
<p>Create the <code>.ssh</code> directory and <code>.ssh/authorized_keys</code> file if they don't already exist</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">mkdir</span> ~/.ssh<br><span class="token function">touch</span> ~/.ssh/authorized_keys</code></pre>
</li>
<li>
<p>Change the permissions of the directory and file if they didn't exist</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">chmod</span> <span class="token number">700</span> ~/.ssh<br><span class="token function">chmod</span> <span class="token number">600</span> ~/.ssh/authorized_keys</code></pre>
</li>
<li>
<p>Append the contents of the public key to the <code>authorized_keys</code> file</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">cat</span> id_rsa.pub <span class="token operator">>></span> ~/.ssh/authorized_keys</code></pre>
</li>
<li>
<p>Download the <code>id_rsa</code> private key file and use it to connect to your server:</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">ssh</span> <span class="token parameter variable">-i</span> id_rsa user@server</code></pre>
</li>
</ol>
<h4>Disabling password authentication</h4>
<p>After setting up SSH keys, disable password authentication to improve server security:</p>
<ol>
<li>
<p>SSH into the host</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">ssh</span> <span class="token parameter variable">-i</span> key user@host</code></pre>
</li>
<li>
<p>Open the <code>sshd</code> configuration file</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/ssh/sshd_config</code></pre>
</li>
<li>
<p>Set the <code>PasswordAuthentication</code> line to <code>no</code></p>
<p>Find the following line in <code>sshd_config</code>:</p>
<pre class="language-sh"><code class="language-sh">PasswordAuthentication <span class="token function">yes</span></code></pre>
<p>Change the value to <code>no</code>:</p>
<pre class="language-sh"><code class="language-sh">PasswordAuthentication no</code></pre>
</li>
<li>
<p>Save and exit the editor</p>
</li>
<li>
<p>Enable changes by restarting the <code>sshd</code> service</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">sudo</span> systemctl restart sshd.service</code></pre>
</li>
</ol>
<h4>Configuring a new account with SSH</h4>
<p>The following steps will highlight how to create a new user account, enable SSH and give them sudo permissions.</p>
<ul>
<li>In the following commands, replace <code>&lt;user&gt;</code> with the name of the user you want to create</li>
</ul>
<ol>
<li>
<p>Access the server which you want to create a new account on and access the root user:</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">sudo</span> <span class="token function">su</span></code></pre>
</li>
<li>
<p>Create a new user and the .ssh directory</p>
<pre class="language-sh"><code class="language-sh">adduser <span class="token operator">&lt;</span>user<span class="token operator">></span><br><span class="token function">mkdir</span> /home/<span class="token operator">&lt;</span>user<span class="token operator">></span>/.ssh</code></pre>
</li>
<li>
<p>Generate a key pair</p>
<p>Set the file location as: <code>/home/&lt;user&gt;/.ssh/id_rsa</code> when prompted by the <code>ssh-keygen</code> command:</p>
<pre class="language-sh"><code class="language-sh">ssh-keygen <span class="token parameter variable">-t</span> rsa</code></pre>
</li>
<li>
<p>Copy the public key into an authorized_keys file</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">cat</span> /home/<span class="token operator">&lt;</span>user<span class="token operator">></span>/.ssh/id_rsa.pub <span class="token operator">></span> /home/<span class="token operator">&lt;</span>user<span class="token operator">></span>/.ssh/authorized_keys</code></pre>
</li>
<li>
<p>Add the user to the users allowed to ssh</p>
<p>Open the file <code>sshd_config</code> (Ubuntu):</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">nano</span> /etc/ssh/sshd_config</code></pre>
<p>Find the line beginning with <code>AllowUsers</code>, if it does not exist add it to the file. The line should look something like:</p>
<pre class="language-sh"><code class="language-sh">AllowUsers <span class="token operator">&lt;</span>user<span class="token operator"><span class="token file-descriptor important">1</span>></span> <span class="token operator">&lt;</span>user<span class="token operator">></span></code></pre>
<ul>
<li>if the line already exists, add your user after a space</li>
</ul>
<p>Save and close the file.</p>
</li>
<li>
<p>Change the owner of the <code>.ssh</code> directory to the new user</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">chown</span> <span class="token parameter variable">-R</span> <span class="token operator">&lt;</span>user<span class="token operator">></span>:<span class="token operator">&lt;</span>user<span class="token operator">></span> /home/<span class="token operator">&lt;</span>user<span class="token operator">></span>/.ssh</code></pre>
</li>
<li>
<p>Restart <code>sshd</code></p>
<pre class="language-sh"><code class="language-sh">systemctl restart sshd</code></pre>
</li>
<li>
<p>(Optional): Give new user superuser permissions</p>
<p>Run the <code>visudo</code> command to open the sudoers file. Add under user permissions, the following line:</p>
<pre class="language-sh"><code class="language-sh">%<span class="token operator">&lt;</span>user<span class="token operator">></span> <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: ALL</code></pre>
</li>
<li>
<p>Download your private key</p>
<p>Once you are setup, make a copy of the private key on a machine you want to use to access the server.</p>
</li>
</ol>

    </div>


    
    <script src="/scripts/nav.js"></script>

</body>
</html>