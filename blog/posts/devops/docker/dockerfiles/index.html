<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dockerfiles</title>
<link rel="stylesheet" href="/css/style.css">
    <nav class="navbar row">
    <button id="toggle" class="hamburger ml-auto"><span></span><span></span><span></span></button>
    <div class="col-12">
        <ul class="nav-content w-100 ml-auto mr-auto">
            <li class="nav-link"><a href="/">Home</a></li>
            <li class="nav-link"><a href="/blog">Blog</a></li>
        </ul>
    </div>
</nav>
    
    
    <link rel="stylesheet" href="/css/theme/prism-atom-dark.css" />

</head>
<body>
    
    
    <div class="p-16 w-60 w-md-80 w-sm-90 ml-auto mr-auto">
        <h1>Dockerfiles</h1>
        <p><b>Created on</b>: <time>Thu, 02 Feb 2023 00:00:00 GMT</time></p>

        
            <div class="row w-100">
                <div class="col-5 col-sm-12">
                    <img 
                        src="/assets/images/devops/docker-whale.png" 
                        alt="thumbnail image" 
                    />
                </div>
        
        
        <div class="col-7 col-sm-12 pl-16 pl-sm-0">
        <h2>Tags</h2>
        <ul>
            
                <li>
                    <a href="/blog/tag/docker">Docker</a>
                </li>
            
        </ul>
        </div></div>

        <hr />

        <h1>Dockerfiles</h1>
<p>As discussed in <a href="/notes/docker/docker_images.html">Docker images</a>, an image can be created from a Dockerfile. This allows images to have layers built upon them, each layer being some command in the <code>Dockerfile</code>.</p>
<h2>Dockerfile gubbins</h2>
<p>A Dockerfile contains a variety of commands, here are some of them:</p>
<ul>
<li><code>FROM &lt;BASE_IMAGE&gt;</code>: Specifies the base image to build on top of</li>
<li><code>EXPOSE &lt;PORT&gt;</code>: Specifies a port to be exposed by the container</li>
<li><code>COPY &lt;HOST_PATH&gt; &lt;CONTAINER_PATH&gt;</code>: Copies the specified content from the host into the container</li>
<li><code>WORKDIR &lt;DIRECTORY&gt;</code>: Sets the current working directory in the container, akin to doing <code>cd &lt;DIR&gt;</code></li>
<li><code>CMD [&lt;FRAGMENT&gt;, &lt;FRAGMENT&gt;, ...]</code>: Runs the specified command when a container is created from the built image</li>
</ul>
<h2>Dockerising a JAR file</h2>
<p>In this example, we will dockerise a Spring Boot web server which serves a static website. Let's first create a directory
for the project and download the JAR file:</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">mkdir</span> dockerised_jar<br><span class="token builtin class-name">cd</span> dockerised_jar/<br><span class="token function">wget</span> https://github.com/MrWalshyType2/SeleniumShoppingTestSite/releases/download/v1.0.0/test_shopping_site.jar<br><span class="token function">touch</span> Dockerfile</code></pre>
<p>Open the <code>Dockerfile</code> and enter the following:</p>
<pre><code># Base image of Java version 17
FROM openjdk:17
# Expose port app is served on in the container
EXPOSE 3000
# Copy JAR into container (COPY HOST_PATH CONTAINER_PATH)
COPY . /usr/src/app
# Set the working directory in the container
WORKDIR /usr/src/app
# Run the JAR file
CMD [&quot;java&quot;, &quot;-jar&quot;, &quot;test_shopping_site.jar&quot;]
</code></pre>
<p>Now that we have a <code>Dockerfile</code>, we can build an image:</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> shopping_site <span class="token builtin class-name">.</span></code></pre>
<p>We can then create a container from the built image:</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">docker</span> run <span class="token parameter variable">-dp</span> <span class="token number">8080</span>:3000 <span class="token parameter variable">--name</span> my_website shopping_site</code></pre>
<p>Now, open <code>localhost:8080</code> in your browser to open the website served by the Dockerised Java application. If all went well, you should see the following in your browser:</p>
<p><img src="https://user-images.githubusercontent.com/29315632/216304156-4720fb84-3fa3-401e-b595-a516684129ba.png" alt="image"></p>
<p>We can then clean up once we are done:</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">docker</span> stop my_website<br><span class="token function">docker</span> <span class="token function">rm</span> my_website</code></pre>
<p>We can then remove the image if we no longer need it as well:</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">docker</span> rmi shopping_site</code></pre>

    </div>


    
    <script src="/scripts/nav.js"></script>

</body>
</html>