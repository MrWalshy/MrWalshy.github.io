<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dockerfiles | morganwalsh.dev</title>
    <link rel="stylesheet" href="/style.css" />
</head>
<body>
    <nav class="navbar row">
    <button id="toggle" class="hamburger ml-auto"><span></span><span></span><span></span></button>
    <div class="col-12">
        <ul class="nav-content w-100 ml-auto mr-auto">
            <li class="nav-link"><a href="/">Home</a></li>
            <li class="nav-link"><a href="/notes">Notes</a></li>
        </ul>
    </div>
</nav>
<div class="row"><div class="col-12"><main class="w-100">
    <div class="p-16 w-80 w-md-100 ml-auto mr-auto">
<h1>Dockerfiles</h1>
<p>As discussed in <a href="/notes/docker/docker_images.html">Docker images</a>, an image can be created from a Dockerfile. This allows images to have layers built upon them, each layer being some command in the <code>Dockerfile</code>.</p>
<h2>Dockerfile gubbins</h2>
<p>A Dockerfile contains a variety of commands, here are some of them:</p>
<ul>
  <li><code>FROM &#x3C;BASE_IMAGE></code>: Specifies the base image to build on top of</li>
  <li><code>EXPOSE &#x3C;PORT></code>: Specifies a port to be exposed by the container</li>
  <li><code>COPY &#x3C;HOST_PATH> &#x3C;CONTAINER_PATH></code>: Copies the specified content from the host into the container</li>
  <li><code>WORKDIR &#x3C;DIRECTORY></code>: Sets the current working directory in the container, akin to doing <code>cd &#x3C;DIR></code></li>
  <li><code>CMD [&#x3C;FRAGMENT>, &#x3C;FRAGMENT>, ...]</code>: Runs the specified command when a container is created from the built image</li>
</ul>
<h2>Dockerising a JAR file</h2>
<p>
  In this example, we will dockerise a Spring Boot web server which serves a static website. Let's first create a directory
  for the project and download the JAR file:
</p>
<pre><code class="language-sh">mkdir dockerised_jar
cd dockerised_jar/
wget https://github.com/MrWalshyType2/SeleniumShoppingTestSite/releases/download/v1.0.0/test_shopping_site.jar
touch Dockerfile
</code></pre>
<p>Open the <code>Dockerfile</code> and enter the following:</p>
<pre><code># Base image of Java version 17
FROM openjdk:17
# Expose port app is served on in the container
EXPOSE 3000
# Copy JAR into container (COPY HOST_PATH CONTAINER_PATH)
COPY . /usr/src/app
# Set the working directory in the container
WORKDIR /usr/src/app
# Run the JAR file
CMD ["java", "-jar", "test_shopping_site.jar"]
</code></pre>
<p>Now that we have a <code>Dockerfile</code>, we can build an image:</p>
<pre><code class="language-sh">docker build -t shopping_site .
</code></pre>
<p>We can then create a container from the built image:</p>
<pre><code class="language-sh">docker run -dp 8080:3000 --name my_website shopping_site
</code></pre>
<p>Now, open <code>localhost:8080</code> in your browser to open the website served by the Dockerised Java application. If all went well, you should see the following in your browser:</p>
<p>
  <img src="https://user-images.githubusercontent.com/29315632/216304156-4720fb84-3fa3-401e-b595-a516684129ba.png" alt="image">
</p>
<p>We can then clean up once we are done:</p>
<pre><code class="language-sh">docker stop my_website
docker rm my_website
</code></pre>
<p>We can then remove the image if we no longer need it as well:</p>
<pre><code class="language-sh">docker rmi shopping_site
</code></pre></div>
    <footer class="bg-primary fg-light p-16">
    <small>Extensible Markdown (.emdd) - &copy; 2023</small>
    <br />
    <small>This site was generated by .emdd</small>
</footer>
</main></div></div>
    <script src="/scripts/common.js"></script>
</body>
</html>
